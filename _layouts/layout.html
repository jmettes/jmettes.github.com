<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>{{ page.title }}</title>
<link title="jmettes - Atom" type="application/atom+xml" rel="alternate" href="/atom.xml" />
<link type="text/css" rel="stylesheet" href="/css/style.css" />
<link rel="shortcut icon" href="/favicon.ico" />
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
<script src='/js/soundcloud.player.api.js' type='text/javascript'></script>
<script src='/js/sc-player.js' type='text/javascript'></script>
{% unless page.url == '/index.html' %}
<meta name="robots" content="noindex">
{% endunless %}
</head>
<body>
<div id="wrapper">
<div id="sidebar">
<div id="bg"><a href="/"></a></div>
{% include blurb.html %}
{% include nav.html %}
</div>
<div id="posts">
{{ content }}
<div id="paginate">
{% if paginator.previous_page %}
{% if paginator.previous_page == 1 %}
<a href="/" id="index-previous">&lt; Newer</a>
{% else %}
<a href="/page{{ paginator.previous_page }}" id="index-previous">&lt; Newer</a>
{% endif %}
{% endif %}
{% if paginator.next_page %}
<a href="/page{{ paginator.next_page }}" id="index-next">Older &gt;</a>
{% endif %}
</div>
</div>
</div>
{% if page.url == "/index.html" %}
<script type="text/javascript">
var fetching = false;
var page = 2;
var loading = $('#paginate')
  .html('<img src=\"/images/loading.gif\"/><br/>Loading...');

$(window).bind('scroll', function() {
  if ($(window).scrollTop() >= $(document).height() - $(window).height() - 120 && !fetching) {
    fetching = true;
    $.ajax({
      url: '/page' + page,
      success: function(data) {
        $(loading).remove();
        $(data).find('.post').appendTo('#posts');
        $(loading).appendTo('#posts');
      },
      error: function(e) {
        $(loading).remove();
        $(window).unbind('scroll');

        if (e.status != 404) {
          $('#posts').append('<p id="noload">Error loading posts. <a href="/page' + page + '">Go to next page</a></p>');
        }
      }
    }, 2000);
    page++;
    fetching = false;
  }
});
var _gaq=[["_setAccount","UA-36175883-1"],["_trackPageview"]];
(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
g.src=("https:"==location.protocol?"//ssl":"//www")+".google-analytics.com/ga.js";
s.parentNode.insertBefore(g,s)}(document,"script"));
</script>
{% endif %}
</body>
</html>
